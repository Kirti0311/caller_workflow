name: Get PR Approver and Merger

on:
  workflow_call:
    outputs:
      approver:
        description: "GitHub username of the person who approved the PR"
        value: ${{ jobs.get-pr-info.outputs.approver }}
      merger:
        description: "GitHub username of the person who merged the PR"
        value: ${{ jobs.get-pr-info.outputs.merger }}

jobs:
  get-pr-info:
    runs-on: ubuntu-latest
    outputs:
      approver: ${{ steps.pr-info.outputs.approver }}
      merger: ${{ steps.pr-info.outputs.merger }}
    steps:
      - name: Get PR Approver and Merger
        id: pr-info
        run: |
            PR_NUMBER="${{ github.event.pull_request.number }}"
            REPO="${{ github.repository }}"

            # Get approvals
            APPROVER=$(gh api repos/$REPO/pulls/$PR_NUMBER/reviews \
            --jq '.[] | select(.state=="APPROVED") | .user.login' | head -1)

            # Get merger info (no --repo needed)
            MERGER=$(gh pr view $PR_NUMBER --json mergedBy --jq '.mergedBy.login')

            echo "approver=$APPROVER" >> $GITHUB_OUTPUT
            echo "merger=$MERGER" >> $GITHUB_OUTPUT
        env:
            GH_TOKEN: ${{ github.token }}